local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local camera = workspace.CurrentCamera
local runService = game:GetService("RunService")

local espBoxes = {}

local function createESP(player)
    if player == localPlayer then return end 

    local box = Drawing.new("Square")
    box.Color = Color3.fromRGB(255, 0, 0) 
    box.Thickness = 2
    box.Filled = false
    box.Transparency = 1

    espBoxes[player] = box
end

local function updateESP()
    for player, box in pairs(espBoxes) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local rootPart = player.Character.HumanoidRootPart
            local screenPosition, onScreen = camera:WorldToViewportPoint(rootPart.Position)

            if onScreen then
                box.Position = Vector2.new(screenPosition.X - 50, screenPosition.Y - 50)
                box.Size = Vector2.new(100, 100)
                box.Visible = true
            else
                box.Visible = false
            end
        else
            box.Visible = false
        end
    end
end

for _, player in pairs(players:GetPlayers()) do
    createESP(player)
end

runService.RenderStepped:Connect(updateESP)

players.PlayerAdded:Connect(createESP)
